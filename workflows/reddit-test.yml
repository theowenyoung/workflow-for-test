name: Send a daily digest telegram message about today's hot reddit posts
on:
  reddit:
    active: false
    url: https://reddit.com/top/
    config:
      outputsMode: combine
jobs:
  telegram:
    name: Send a telegram message
    runs-on: ubuntu-latest
    steps:
      - name: Translate to ZH
        id: translate
        uses: actions/github-script@v2
        with:
          script: |
            const mock = `æˆ‘æ›¾ç¥–çˆ¶é˜¿è«æ–¯ Â· æ´›å…‹æ‹¿ç€ä»–ç¥–çˆ¶åœ¨ 1775 å¹´åˆ—å…‹æ˜Ÿæ•¦æˆ˜å½¹ä¸­å‘è‹±å›½äººå¼€ç«çš„æ­¥æª
            å¤§å¤šæ•°äººæ²¡æœ‰æ„è¯†åˆ°ä»€ä¹ˆæ¯”ä»–ä»¬æƒ³è±¡çš„è¦æ–°ï¼Ÿ%0Aä½›ç½—é‡Œè¾¾å·é©¬åŠ äººèµ«å…‹æ–¯çš®ç‰¹å¸ƒè’‚å‰æ ¼ï¼Œ è°ç›´ä¸Šå¤„ç†å®ƒ%0Aæˆ‘å‡æ‰äº† 170 ç£…ï¼Œ ç„¶ååˆ‡é™¤äº† 9 ç£…å¤šä½™çš„çš®è‚¤ã€‚æˆ‘çš„ä¼¤ç–¤è®©æˆ‘çœ‹èµ·æ¥åƒåœ£è¯èŠ‚å‰å™©æ¢¦ä¸­çš„èè‰ã€‚
            å‰é©¬æ¥è¥¿äºšæ€»ç†é©¬å“ˆè’‚å°” Â· ç©†ç½•é»˜å¾·è¯´ï¼Œ ç©†æ–¯æ—æœ‰æƒç”Ÿæ°”å’Œæ€å®³æ•°ç™¾ä¸‡æ³•å›½äºº
            å­˜ä¸€åªå°å°é¸ŸğŸ¥°
            åˆæ­¥ç»“æœï¼š EoL - æ˜¯ï¼Œ å¤§éº» - å¦
            LPTï¼šçŸ¥é“ä½ è¦è¢«è§£é›‡äº†å—ï¼Ÿé‚£ä¹ˆï¼Œ çœ‹åœ¨ä¸Šå¸çš„ä»½ä¸Šï¼Œ ä¸è¦åœ¨ç¬¬ä¸€æ¬¡è”‘è§†ä¸­å…ˆæå‡ºè¾èŒã€‚ä»–ä»¬è®©ä½ å»çš„ä¼šè®®æ˜¯æ‚¨æå–ä¸€ä¸ªä¼Ÿå¤§çš„é£æ•£åŒ…å’Œç§¯æçš„å‚è€ƒçš„æœºä¼šã€‚é›‡ä¸»ä»¬æƒ³è¦ä¸€ä¸ªå¹²å‡€çš„ç¦»å¼€â€”â€”ä¸è¦è®©ä»–ä»¬çš„ç”Ÿæ´»å˜å¾—è½»æ¾ã€‚
            ç±³å¥‡ Â· éº¦åº·å¥ˆå°”çš„æ”¯æŒç‡åœ¨å…¨å›½èŒƒå›´å†…ä¸‹é™ï¼Œ å°½ç®¡è‰¾ç±³ Â· ç§‘å°¼ Â· å·´é›·ç‰¹çš„æååœ¨æ”¿æ²»ä¸Šè·èƒœ
            é‚®ä»¶å»¶è¿Ÿåœ¨å®¾å¤•æ³•å°¼äºšå·ç”šè‡³æ›´ç³Ÿï¼Œ 42%25 25 çš„è´¹åŸé‚®ä»¶éœ€è¦è¶…è¿‡ 5 å¤©
            å½“å¤©ï¼Œ3åçŠ¹å¤ªç”·å­è¢«å¸¦åˆ°å¥¥æ–¯å¨è¾›é›†ä¸­è¥ï¼Œå°†10ä¸ªæ•°å­—åˆ†å¼€ï¼Œ73å¹´åé‡èšã€‚
            è·¯æ€’
            è™šä¼ªæ˜¯çœŸå®çš„
            åœŸç‹¼å¯¹ç±³åˆ‡å°” Â· ç±³å‹’çš„æ”¾å¼ƒæƒåˆ©
            å½“ä½ è¿«ä½¿ä¸€ä¸ªå¥³äººå •èƒï¼Œ å¹¶è¯´ä½ å°†å®Œå…¨ç›‘æŠ¤ï¼Œ ç„¶åå¥¹æ•¢æŠ±ç€ä½ åŒæ„
            å…³äºå¸ƒé‡Œå¥‡Â· æ²ƒå…‹ä»æ¶æ¯’çš„ç‹—æ”»å‡»ä¸­æ•‘äº†ä»–çš„å¦¹å¦¹ï¼Œ ä»–è¯´ï¼Œ "å¦‚æœæœ‰äººè¦æ­»ï¼Œ æˆ‘æƒ³åº”è¯¥æ˜¯æˆ‘ï¼Œ"åœ¨ä»–çš„è‹±å‹‡è¡Œä¸ºåï¼Œä»–è¢«ä¸–ç•Œæ‹³å‡»ç†äº‹ä¼šåŠ å†•ä¸ºé‡é‡çº§ä¸–ç•Œå† å†›ä¸€å¤©ã€‚nsfw.
            ä½æ²»äºšå·å‚è®®å‘˜è·³è¿‡è¾©è®ºåï¼Œ æ°‘ä¸»å…šå¯¹æ‰‹ç—…æ¯’
            ç‰¹æœ—æ™®æœ€è¿‘å¤šæ¬¡è¢«è®¤å®šä¸ºé•¿è€ä¼šæ•™å¾’ï¼Œç°åœ¨ä»–å£°ç§°è‡ªå·±æ˜¯ä¸€ä¸ªéå®—æ´¾åŸºç£å¾’ã€‚è¯•å›¾å¸å¼•æœ€å¹¿æ³›çš„å®¹æ˜“å—éª—çš„åŸºç£æ•™é€‰æ°‘ï¼Œ æˆ‘æ˜ç™½äº†ã€‚
            åŠ æ‹¿å¤§å®˜å‘˜å› æ®´æ‰“å—å®¡ï¼Œ è¯æ˜ä»–ä¸æ˜¯æ•…æ„å…ˆæ‰”æ‰‹é“çš„å¥³äººè„¸
            è¿™ä¸æ˜¯æˆ‘çš„ä¸€å‘¨
            é˜´å½±åœ°äº11æœˆ23æ—¥åˆ°è¾¾
            é˜¿å…°å¨œè¦ç¦»å¼€å…¬é¸¡ç‰™é½¿
            å¤ªä¸èˆ’æœäº†...
            æˆ‘æ‰€æœ‰çš„åŒäº‹éƒ½åŒæ„åœ¨ä¸‡åœ£èŠ‚æ‰“æ‰®æˆè“ç²¾çµã€‚æˆ‘æ˜¯å”¯ä¸€ä¸€ä¸ªç»å†å®ƒçš„äººã€‚
            è¿™ä¸æ˜¯æˆ‘çš„é”™ï¼Œ æˆ‘ä¸èƒ½ä¸ºæˆ‘çš„å­©å­åšçˆ¶æ¯ã€‚`
            return mock
          result-encoding: string
      - name: Format message
        id: format
        uses: actions/github-script@v2
        env:
          TEXT: ${{ steps.translate.outputs.result }}
        with:
          script: |
            const outputs = ${{ toJSON(on.reddit.outputs) }};
            const titleStr = process.env.TEXT || "";
            const titleArray = titleStr.split('%0A')
            const date = new Date()
            const titles = outputs.map((item,index)=>{
              return `<a href="${item.link}">${index+1}. ${titleArray[index]}</a>`
            }).join(`

            `);
            const message = `<b>${titleArray[0].slice(0,36)}...</b>

            ä»Šå¤©(${date.getFullYear()}-${date.getMonth()}-${date.getDate()})åˆ†äº«${outputs.length}æ¡redditçƒ­é—¨å¸–ï¼Œå¦‚ä¸‹ï¼š

            ${titles}

            #redditæ¯æ—¥çƒ­é—¨ #redditä¸­æ–‡
            `
            return {message:message}
      - name: Send a telegram message
        uses: appleboy/telegram-action@v0.1.0
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: ${{fromJSON(steps.format.outputs.result).message}}
          format: html
